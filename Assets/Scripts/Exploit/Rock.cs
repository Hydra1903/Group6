using System.Collections;
using UnityEngine;

public class Rock : MonoBehaviour
{
    public static Rock instance;
    public int maxHealth = 3; // Số máu tối đa của viên đá
    private int currentHealth;

    private SpriteRenderer spriteRenderer;
    public Color hitColor = Color.red; // Màu chớp khi bị đánh
    private Color originalColor;
    public float hitEffectDuration = 0.1f; // Thời gian hiệu ứng hit

    public GameObject rockExplosionEffectPrefab; // Prefab hiệu ứng
    public Transform rockPosition;              // Vị trí của đá

    public GameObject rockItemPrefab;

    void Start()
    {
        currentHealth = maxHealth;
        spriteRenderer = GetComponent<SpriteRenderer>();
        originalColor = spriteRenderer.color; // Lưu màu gốc của viên đá
    }

    // Hàm này được gọi khi ToolCollider chạm vào viên đá
    public void TakeDamage(int damage)
    {
        currentHealth -= damage;

        // Gọi hiệu ứng hit
        StartCoroutine(HitEffect());

        if (currentHealth <= 0)
        {
            // Spawn item đá
            GameObject rockItem = Instantiate(rockItemPrefab, rockPosition.position, Quaternion.identity);

            DestroyRock();
        }
    }

    // Hiệu ứng hit: viên đá chớp màu đỏ rồi trở lại bình thường
    private IEnumerator HitEffect()
    {
        // Hiển thị hiệu ứng văng mành vụn
        GameObject effect = Instantiate(rockExplosionEffectPrefab, rockPosition.position, Quaternion.identity);

        // Hủy hiệu ứng sau thời gian tồn tại
        Destroy(effect, 2f);

        spriteRenderer.color = hitColor; // Đổi màu thành màu hit
        yield return new WaitForSeconds(hitEffectDuration);
        spriteRenderer.color = originalColor; // Đổi màu lại như cũ
    }

    // Hàm phá hủy viên đá
    private void DestroyRock()
    {
        // Có thể thêm hiệu ứng phá hủy hoặc âm thanh ở đây
        Destroy(gameObject); // Phá hủy viên đá
    }

    // Xử lý va chạm với ToolCollider
    private void OnTriggerEnter2D(Collider2D other)
    {
        if (other.CompareTag("Tool")) // Giả sử ToolCollider có tag là "Tool"
        {
            TakeDamage(1); // Gây 1 điểm sát thương cho mỗi lần va chạm
        }
    }
}

